<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emmanuel Enwesi Foundation Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #111827;
            color: #f3f4f6;
        }
        .container {
            max-width: 800px;
        }
        .bg-card {
            background-color: #1f2937;
        }
        .btn-primary {
            background-color: #071ca6;
            color: #ffffff;
        }
        .btn-primary:hover {
            background-color: #05126f;
        }
        .btn-secondary {
            background-color: #d40c31;
            color: #ffffff;
        }
        .btn-secondary:hover {
            background-color: #a40b2a;
        }
        .correct-answer {
            background-color: #10b981 !important;
            color: white;
            border-color: #047857;
        }
        .incorrect-answer {
            background-color: #ef4444 !important;
            color: white;
            border-color: #b91c1c;
        }
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }
        .leaderboard-table th, .leaderboard-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #374151;
        }
        .leaderboard-table th {
            background-color: #374151;
        }
    </style>
</head>
<body class="p-4 flex flex-col items-center justify-center min-h-screen">
    <div class="logo-container mb-8 w-48">
        <img id="logo" src="logo.png" alt="Emmanuel Enwesi Foundation Logo" class="w-full h-auto">
    </div>
    <div id="app" class="container mx-auto p-8 rounded-xl shadow-lg bg-card border border-gray-700">
    </div>
    <footer class="mt-8 text-center text-gray-500 text-sm">
        <p>Developed by Emmanuel Enwesi & EEF</p>
    </footer>
    <script>
        // REPLACE THIS URL WITH YOUR DEPLOYED GOOGLE APPS SCRIPT URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw4EsNikVpkk6uzodiR4XbRU7ZOEFl7czS-DyRWTJRaGsV9JguSpzNooUL2XDcLMAG3JQ/exec';

        const quizQuestions = [
            { question: "Which security principle protects against improper disclosure of information?", options: ["Integrity", "Confidentiality", "Availability", "Non-repudiation"], answer: "Confidentiality" },
            { question: "What does 'PII' stand for?", options: ["Personal Identity Information", "Personally Identifiable Information", "Private Information Initiative", "Protected Identity Information"], answer: "Personally Identifiable Information" },
            { question: "Which term refers to information about one's health status that needs protection?", options: ["PII", "CSI", "PHI", "DMI"], answer: "PHI" },
            { question: "Which attack is mitigated by using encryption to protect communication?", options: ["Dumpster diving", "Eavesdropping", "Wiretapping", "Snooping"], answer: "Wiretapping" },
            { question: "What security principle ensures data is complete, accurate, and has not been altered in an unauthorized manner?", options: ["Confidentiality", "Availability", "Integrity", "Privacy"], answer: "Integrity" },
            { question: "What is the primary factor in the reliability of information and systems?", options: ["Confidentiality", "Availability", "Non-repudiation", "Integrity"], answer: "Integrity" },
            { question: "Which attack is best mitigated by the principle of least privilege?", options: ["Impersonation", "Man-In-The-Middle", "Unauthorized modification", "Replay attacks"], answer: "Unauthorized modification" },
            { question: "Which attack involves the attacker placing themselves in the middle of a communication session?", options: ["Replay attack", "Unauthorized modification", "Impersonation", "Man-In-The-Middle (MITM) attack"], answer: "Man-In-The-Middle (MITM) attack" },
            { question: "What security principle ensures systems and data are accessible at the time users need them?", options: ["Integrity", "Confidentiality", "Availability", "Non-repudiation"], answer: "Availability" },
            { question: "In the context of availability, what term is a measure of the degree to which an organization depends on an information system?", options: ["Criticality", "Reliability", "Dependability", "Feasibility"], answer: "Criticality" },
            { question: "What is the legal term for protection against an individual falsely denying having performed a particular action?", options: ["Authentication", "Authorization", "Non-repudiation", "Accounting"], answer: "Non-repudiation" },
            { question: "What is the process of verifying a user's claimed identity?", options: ["Authorization", "Authentication", "Identification", "Accounting"], answer: "Authentication" },
            { question: "Which of the following is a 'something you have' method of authentication?", options: ["Biometrics", "Password", "PIN", "Token"], answer: "Token" },
            { question: "The combined use of a user ID and password is an example of what?", options: ["Multi-factor authentication", "Biometric authentication", "Single-factor authentication", "Token-based authentication"], answer: "Single-factor authentication" },
            { question: "What is the purpose of 'password history requirements'?", options: ["To force password changes", "To prevent password reuse", "To set minimum length", "To describe character types"], answer: "To prevent password reuse" },
            { question: "What step in the triple A process involves maintaining logs of user activity?", options: ["Authentication", "Authorization", "Accounting", "Identification"], answer: "Accounting" },
            { question: "What is 'the right of an individual to control the distribution of information about themselves'?", options: ["Confidentiality", "Privacy", "Non-repudiation", "Integrity"], answer: "Privacy" },
            { question: "Which regulation has multinational implications and applies to any organization handling private data of people in the EU?", options: ["HIPAA", "SOX", "GDPR", "PCI DSS"], answer: "GDPR" },
            { question: "What is a measure of the extent to which an entity is threatened by a potential circumstance or event?", options: ["Vulnerability", "Threat", "Risk", "Asset"], answer: "Risk" },
            { question: "What is a gap or weakness in an organization's protection of its valuable assets?", options: ["Risk", "Threat", "Impact", "Vulnerability"], answer: "Vulnerability" }
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let userName = '';
        let timer = null;
        let timeLeft = 15;
        const app = document.getElementById('app');

        window.onload = () => {
            document.getElementById('logo').src = "logo.png";
            renderWelcomeScreen();
        };

        function shuffleArray(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        function renderWelcomeScreen() {
            app.innerHTML = `
                <div class="text-center">
                    <h1 class="text-4xl font-bold mb-4 text-white">Emmanuel Enwesi Foundation Week 1 Quiz üèÜ</h1>
                    <p class="text-lg text-gray-300 mb-6">Test your knowledge on cybersecurity fundamentals!</p>
                    <input type="text" id="userNameInput" placeholder="Enter your name e.g 'Emmanuel Enwesi Group X'" class="w-full md:w-2/3 px-4 py-2 rounded-md bg-gray-700 text-white border border-gray-600 mb-4 focus:outline-none focus:ring-2 focus:ring-[#071ca6]">
                    <button onclick="startGame()" class="btn-primary w-full md:w-1/2 py-3 rounded-md text-lg font-semibold transition duration-300 ease-in-out transform hover:scale-105">Start Quiz</button>
                    <button onclick="renderLeaderboard()" class="btn-secondary w-full md:w-1/2 py-3 mt-4 rounded-md text-lg font-semibold transition duration-300 ease-in-out transform hover:scale-105">View Leaderboard</button>
                </div>
            `;
        }

        function renderQuestion() {
            if (currentQuestionIndex >= quizQuestions.length) {
                endGame();
                return;
            }
            const questionData = quizQuestions[currentQuestionIndex];
            app.innerHTML = `
                <div class="text-center mb-6">
                    <h2 class="text-3xl font-bold text-white">Question ${currentQuestionIndex + 1} of ${quizQuestions.length}</h2>
                    <p class="text-lg text-gray-400 mt-2">Time left: <span id="timer" class="font-bold" style="color: #071ca6;">15</span>s</p>
                    <div class="w-full bg-gray-700 rounded-full h-2.5 mt-2">
                        <div id="progressBar" class="h-2.5 rounded-full" style="background-color: #d40c31; width: 100%;"></div>
                    </div>
                </div>
                <div class="p-6 bg-gray-800 rounded-lg shadow-md border border-gray-700">
                    <p class="text-xl font-medium mb-6 text-gray-200">${questionData.question}</p>
                    <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${questionData.options.map(option => `
                            <button class="option-btn bg-gray-700 text-white border border-gray-600 rounded-lg p-4 text-left transition duration-200 ease-in-out transform hover:bg-gray-600 hover:scale-105" data-option="${option}">
                                ${option}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
            document.querySelectorAll('.option-btn').forEach(button => {
                button.addEventListener('click', handleAnswer);
            });
            startTimer();
        }

        async function renderLeaderboard() {
            app.innerHTML = `
                <div class="text-center mb-6">
                    <h2 class="text-3xl font-bold text-white">Leaderboard ü•á</h2>
                    <p class="text-lg text-gray-400 mt-2">Loading...</p>
                </div>
            `;
            try {
                const response = await fetch(`${SCRIPT_URL}?action=getLeaderboard`);
                const leaderboard = await response.json();

                app.innerHTML = `
                    <div class="text-center mb-6">
                        <h2 class="text-3xl font-bold text-white">Leaderboard ü•á</h2>
                    </div>
                    <div class="bg-gray-800 rounded-lg shadow-md overflow-hidden border border-gray-700">
                        <table class="leaderboard-table">
                            <thead>
                                <tr>
                                    <th class="text-gray-300">Rank</th>
                                    <th class="text-gray-300">Name</th>
                                    <th class="text-gray-300">Score</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${leaderboard.map((player, index) => `
                                    <tr class="${index % 2 === 0 ? 'bg-gray-800' : 'bg-gray-700'}">
                                        <td class="font-bold text-lg" style="color: #071ca6;">${index + 1}</td>
                                        <td>${player.name}</td>
                                        <td>${player.score}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    <div class="text-center mt-6">
                        <button onclick="renderWelcomeScreen()" class="btn-primary w-full md:w-1/2 py-3 rounded-md text-lg font-semibold transition duration-300 ease-in-out transform hover:scale-105">Back to Home</button>
                    </div>
                `;
            } catch (error) {
                app.innerHTML = `
                    <div class="text-center">
                        <h2 class="text-3xl font-bold text-red-500">Error fetching leaderboard üòü</h2>
                        <p class="text-lg text-gray-400 mt-2">Please try again later.</p>
                        <button onclick="renderWelcomeScreen()" class="btn-primary w-full md:w-1/2 py-3 rounded-md text-lg font-semibold transition duration-300 ease-in-out transform hover:scale-105">Back to Home</button>
                    </div>
                `;
                console.error("Failed to fetch leaderboard:", error);
            }
        }

        function renderEndScreen() {
            saveScore(userName, score);
            app.innerHTML = `
                <div class="text-center">
                    <h2 class="text-4xl font-bold text-white mb-4">Quiz Complete! üéâ</h2>
                    <p class="text-2xl text-gray-300 mb-6">${userName}, your final score is: <span class="font-extrabold" style="color: #071ca6;">${score}</span> out of ${quizQuestions.length}</p>
                    <button onclick="renderWelcomeScreen()" class="btn-primary w-full md:w-1/2 py-3 rounded-md text-lg font-semibold transition duration-300 ease-in-out transform hover:scale-105">Play Again</button>
                    <button onclick="renderLeaderboard()" class="btn-secondary w-full md:w-1/2 py-3 mt-4 rounded-md text-lg font-semibold transition duration-300 ease-in-out transform hover:scale-105">View Leaderboard</button>
                </div>
            `;
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        function startGame() {
            userName = document.getElementById('userNameInput').value.trim();
            if (!userName) {
                alert('Please enter your name to start!');
                return;
            }
            currentQuestionIndex = 0;
            score = 0;
            shuffleArray(quizQuestions);
            renderQuestion();
        }

        function handleAnswer(event) {
            clearInterval(timer);
            const selectedOption = event.target.getAttribute('data-option');
            const correctAnswer = quizQuestions[currentQuestionIndex].answer;
            document.querySelectorAll('.option-btn').forEach(button => {
                button.disabled = true;
                if (button.getAttribute('data-option') === correctAnswer) {
                    button.classList.add('correct-answer');
                } else if (button.getAttribute('data-option') === selectedOption) {
                    button.classList.add('incorrect-answer');
                }
            });

            if (selectedOption === correctAnswer) score++;

            setTimeout(() => {
                currentQuestionIndex++;
                renderQuestion();
            }, 1500);
        }

        function startTimer() {
            timeLeft = 15;
            const progressBar = document.getElementById('progressBar');
            const timerElement = document.getElementById('timer');
            timerElement.textContent = timeLeft;
            progressBar.style.width = `${(timeLeft / 15) * 100}%`;

            timer = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                progressBar.style.width = `${(timeLeft / 15) * 100}%`;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    currentQuestionIndex++;
                    renderQuestion();
                }
            }, 1000);
        }

        function endGame() {
            saveScore(userName, score);
            renderEndScreen();
        }

        async function saveScore(name, score) {
            try {
                const response = await fetch(`${SCRIPT_URL}?action=addScore&name=${encodeURIComponent(name)}&score=${score}`);
                const result = await response.json();
                console.log(result);
            } catch (error) {
                console.error("Failed to save score:", error);
            }
        }
    </script>
</body>
</html>
